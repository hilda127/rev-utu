{"version":3,"file":"component---src-templates-book-template-js-cc220dafeb1560f6b23d.js","mappings":"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","sources":["webpack://create-react-app/./node_modules/miko/src/components/IconLeft2Right.js","webpack://create-react-app/./node_modules/miko/src/components/IconRight2Left.js","webpack://create-react-app/./node_modules/miko/src/components/PageBook.module.css","webpack://create-react-app/./node_modules/miko/src/components/PageBook.js","webpack://create-react-app/./src/templates/BookTemplate.js"],"sourcesContent":["import React from \"react\";\nexport default function IconLeft2Right(props) {\n  var className = props.className;\n  return /*#__PURE__*/React.createElement(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    fill: \"none\",\n    viewBox: \"0 0 48 48\",\n    className: className\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    fill: \"#000\",\n    fillOpacity: \".01\",\n    d: \"M0 0h48v48H0z\"\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    stroke: \"#fff\",\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\",\n    strokeWidth: \"4\",\n    d: \"M34 24H6m16-12 12 12-12 12m20-24v24\"\n  }));\n}","import React from \"react\";\nexport default function IconRight2Left(props) {\n  var className = props.className;\n  return /*#__PURE__*/React.createElement(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    fill: \"none\",\n    viewBox: \"0 0 48 48\",\n    className: className\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    fill: \"#000\",\n    \"fill-opacity\": \".01\",\n    d: \"M0 0h48v48H0z\"\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    stroke: \"#fff\",\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\",\n    strokeWidth: \"4\",\n    d: \"M14 24h28M26 36 14 24l12-12M5 36V12\"\n  }));\n}","// extracted by mini-css-extract-plugin\nexport var footer = \"PageBook-module--footer--ZlGhm\";\nexport var footerNavButton = \"PageBook-module--footerNavButton--oqrRx\";\nexport var header = \"PageBook-module--header--X7m9B\";\nexport var headerBackIcon = \"PageBook-module--headerBackIcon--WJDWn\";\nexport var headerBackLink = \"PageBook-module--headerBackLink--bZ3Kj\";\nexport var headerButton = \"PageBook-module--headerButton--ZaX2H\";\nexport var headerHidden = \"PageBook-module--headerHidden--oTfdR\";\nexport var headerIcon = \"PageBook-module--headerIcon--sdxsP\";\nexport var headerIconText = \"PageBook-module--headerIconText--9+hc4\";\nexport var headerLeftSection = \"PageBook-module--headerLeftSection--ycUBL\";\nexport var headerNavButton = \"PageBook-module--headerNavButton--Dn5UH\";\nexport var headerRightSection = \"PageBook-module--headerRightSection--8JcJi\";\nexport var headerTitle = \"PageBook-module--headerTitle--Lhbag\";\nexport var page = \"PageBook-module--page--v0sZP\";\nexport var pageImage = \"PageBook-module--pageImage--kkc6U\";\nexport var pagePadding = \"PageBook-module--pagePadding--FXsCU\";\nexport var pageSpanHeight = \"PageBook-module--pageSpanHeight--lDq2Q\";\nexport var pageSpanWidth = \"PageBook-module--pageSpanWidth--1BlA+\";\nexport var pageWebtoon = \"PageBook-module--pageWebtoon--14fsE\";\nexport var pageWrapper = \"PageBook-module--pageWrapper--m-1hH\";","import _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { useMemo, useEffect, useState, useRef, useCallback } from \"react\";\nimport { Link } from \"gatsby\";\nimport { useInView } from \"react-intersection-observer\";\nimport classnames from \"classnames\";\nimport { decryptBuffer, createBlobUrl } from \"../utils/crypto\";\nimport { fetchWithRetries } from \"../utils/fetch\";\nimport { decrypt } from \"../utils/string\";\nimport Layout from \"./Layout\";\nimport Logo from \"./Logo\";\nimport IconSettings from \"./IconSettings\";\nimport IconLeft2Right from \"./IconLeft2Right\";\nimport IconRight2Left from \"./IconRight2Left\";\nimport Image from \"./Image\";\nimport useLocalStorage from \"../hooks/useLocalStorage\";\nimport useWindowSize from \"../hooks/useWindowSize\";\nimport * as styles from \"./PageBook.module.css\";\nvar READING_MODE_KEY = \"reading_mode\";\nvar READING_MODE_WIDTH = \"0\";\nvar READING_MODE_HEIGHT = \"1\";\nvar READING_MODE_WEBTOON = \"2\";\nvar READING_MODE_COUNT = 3;\nvar DIRECTION_KEY = \"directon\";\nvar DIRECTION_LEFT_TO_RIGHT = \"0\";\nvar DIRECTION_RIGHT_TO_LEFT = \"1\";\nvar DIRECTION_COUNT = 2;\nexport default function PageBook(props) {\n  var _props$data = props.data,\n      _props$data$bookMeta = _props$data.bookMeta,\n      dimensions = _props$data$bookMeta.dimensions,\n      name = _props$data$bookMeta.name,\n      bookPages = _props$data.bookPages,\n      _props$pageContext = props.pageContext,\n      prevPath = _props$pageContext.prevPath,\n      nextPath = _props$pageContext.nextPath;\n  var decryptedName = useMemo(function () {\n    return decrypt(name);\n  }, [name]);\n\n  var _useLocalStorage = useLocalStorage(READING_MODE_KEY, READING_MODE_WIDTH),\n      readingMode = _useLocalStorage[0],\n      setReadingMode = _useLocalStorage[1];\n\n  var _useLocalStorage2 = useLocalStorage(DIRECTION_KEY, DIRECTION_LEFT_TO_RIGHT),\n      direction = _useLocalStorage2[0],\n      setDirection = _useLocalStorage2[1];\n\n  var _useWindowSize = useWindowSize(),\n      windowWidth = _useWindowSize.width,\n      windowHeight = _useWindowSize.height;\n\n  var _useState = useState(true),\n      navHidden = _useState[0],\n      setNavHidden = _useState[1];\n\n  var goBack = useCallback(function (pageIndex) {\n    var currentPageEl = document.getElementById(\"page-\" + pageIndex);\n    var currentPageTop = currentPageEl.getBoundingClientRect().top;\n\n    if (currentPageTop < -5) {\n      currentPageEl.scrollIntoView();\n    } else if (pageIndex > 0) {\n      var prevPageEl = document.getElementById(\"page-\" + (pageIndex - 1));\n      prevPageEl.scrollIntoView();\n    }\n  }, []);\n  var goForward = useCallback(function (pageIndex) {\n    var currentPageEl = document.getElementById(\"page-\" + pageIndex);\n    var currentPageTop = currentPageEl.getBoundingClientRect().top;\n\n    if (currentPageTop > 5) {\n      currentPageEl.scrollIntoView();\n    } else if (pageIndex < bookPages.edges.length - 1) {\n      var nextPageEl = document.getElementById(\"page-\" + (pageIndex + 1));\n      nextPageEl.scrollIntoView();\n    }\n  }, []);\n  useEffect(function () {\n    function click(x, y) {\n      var ev = new MouseEvent(\"click\", {\n        view: window,\n        bubbles: true,\n        cancelable: true,\n        clientX: x,\n        clientY: y\n      });\n      var el = document.elementFromPoint(x, y);\n      el.dispatchEvent(ev);\n    }\n\n    function downHandler(_ref) {\n      var key = _ref.key;\n\n      if (key === \"ArrowLeft\") {\n        click(windowWidth / 12, windowHeight / 2);\n      } else if (key === \"ArrowRight\") {\n        click(11 * windowWidth / 12, windowHeight / 2);\n      }\n    }\n\n    window.addEventListener(\"keydown\", downHandler);\n    return function () {\n      window.removeEventListener(\"keydown\", downHandler);\n    };\n  }, []);\n  var onPageClick = useCallback(function (e, pageIndex) {\n    var windowWidth = window.innerWidth;\n    var clickX = e.clientX;\n\n    if (clickX < windowWidth / 10) {\n      if (direction === DIRECTION_LEFT_TO_RIGHT) {\n        goBack(pageIndex);\n      } else {\n        goForward(pageIndex);\n      }\n    } else if (clickX < 9 * windowWidth / 10) {\n      setNavHidden(function (flag) {\n        return !flag;\n      });\n    } else {\n      if (direction === DIRECTION_LEFT_TO_RIGHT) {\n        goForward(pageIndex);\n      } else {\n        goBack(pageIndex);\n      }\n    }\n  }, [goBack, goForward, setNavHidden, direction]);\n  var onReadingModeButtonClick = useCallback(function () {\n    setReadingMode(String((parseInt(readingMode) + 1) % READING_MODE_COUNT));\n  }, [setReadingMode, readingMode]);\n  var onDirectionButtonClick = useCallback(function () {\n    setDirection(String((parseInt(direction) + 1) % DIRECTION_COUNT));\n  }, [setDirection, direction]);\n  return /*#__PURE__*/React.createElement(Layout, null, /*#__PURE__*/React.createElement(Header, {\n    title: decryptedName,\n    hidden: navHidden,\n    onReadingModeButtonClick: onReadingModeButtonClick,\n    onDirectionButtonClick: onDirectionButtonClick,\n    readingMode: readingMode,\n    direction: direction,\n    prevPath: prevPath,\n    nextPath: nextPath\n  }), bookPages.edges.map(function (_ref2, index) {\n    var publicURL = _ref2.node.publicURL;\n    var _dimensions$index = dimensions[index],\n        pageWidth = _dimensions$index[0],\n        pageHeight = _dimensions$index[1];\n    return /*#__PURE__*/React.createElement(Page, {\n      index: index,\n      pageHeight: pageHeight,\n      pageWidth: pageWidth,\n      publicURL: publicURL,\n      readingMode: readingMode,\n      windowHeight: windowHeight,\n      windowWidth: windowWidth,\n      onPageClick: onPageClick,\n      key: publicURL\n    });\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.footer\n  }, prevPath != null ? /*#__PURE__*/React.createElement(Link, {\n    to: prevPath,\n    className: styles.footerNavButton\n  }, \"PREV\") : null, nextPath != null ? /*#__PURE__*/React.createElement(Link, {\n    to: nextPath,\n    className: styles.footerNavButton\n  }, \"NEXT\") : null));\n}\n\nfunction Header(props) {\n  var _classnames;\n\n  var title = props.title,\n      hidden = props.hidden,\n      readingMode = props.readingMode,\n      direction = props.direction,\n      onReadingModeButtonClick = props.onReadingModeButtonClick,\n      onDirectionButtonClick = props.onDirectionButtonClick,\n      prevPath = props.prevPath,\n      nextPath = props.nextPath;\n  var headerClassName = classnames(styles.header, (_classnames = {}, _classnames[styles.headerHidden] = hidden, _classnames));\n  var readingModeText = useMemo(function () {\n    if (readingMode === READING_MODE_HEIGHT) {\n      return \"H\";\n    } else if (readingMode === READING_MODE_WIDTH) {\n      return \"W\";\n    } else {\n      return \"T\";\n    }\n  }, [readingMode]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: headerClassName\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.headerLeftSection\n  }, /*#__PURE__*/React.createElement(Link, {\n    to: \"/\",\n    className: styles.headerBackLink\n  }, /*#__PURE__*/React.createElement(Logo, {\n    className: styles.headerBackIcon\n  })), /*#__PURE__*/React.createElement(\"div\", null, /*#__PURE__*/React.createElement(\"p\", {\n    className: styles.headerTitle\n  }, title)), prevPath != null ? /*#__PURE__*/React.createElement(Link, {\n    to: prevPath,\n    className: styles.headerNavButton\n  }, \"PREV\") : null, nextPath != null ? /*#__PURE__*/React.createElement(Link, {\n    to: nextPath,\n    className: styles.headerNavButton\n  }, \"NEXT\") : null), /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.headerRightSection\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    className: styles.headerButton,\n    onClick: onDirectionButtonClick\n  }, direction === DIRECTION_LEFT_TO_RIGHT ? /*#__PURE__*/React.createElement(IconLeft2Right, {\n    className: styles.headerIcon\n  }) : /*#__PURE__*/React.createElement(IconRight2Left, {\n    className: styles.headerIcon\n  })), /*#__PURE__*/React.createElement(\"button\", {\n    className: styles.headerButton,\n    onClick: onReadingModeButtonClick\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: styles.headerIconText\n  }, readingModeText))));\n}\n\nfunction Page(props) {\n  var _classnames2;\n\n  var index = props.index,\n      pageHeight = props.pageHeight,\n      pageWidth = props.pageWidth,\n      publicURL = props.publicURL,\n      readingMode = props.readingMode,\n      windowHeight = props.windowHeight,\n      windowWidth = props.windowWidth,\n      onPageClick = props.onPageClick;\n\n  var _useState2 = useState(null),\n      imageBuffer = _useState2[0],\n      setImageBuffer = _useState2[1];\n\n  var _useState3 = useState(null),\n      blobUrl = _useState3[0],\n      setBlobUrl = _useState3[1];\n\n  var onceRef = useRef(false);\n\n  var _useInView = useInView({\n    rootMargin: windowHeight * 2.5 + \"px 0px \" + windowHeight * 3.5 + \"px\"\n  }),\n      ref = _useInView.ref,\n      inView = _useInView.inView;\n\n  useEffect(function () {\n    function fetchImage() {\n      return _fetchImage.apply(this, arguments);\n    }\n\n    function _fetchImage() {\n      _fetchImage = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var res, buffer;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return fetchWithRetries(publicURL, 1000, 5);\n\n              case 2:\n                res = _context.sent;\n                _context.next = 5;\n                return res.arrayBuffer();\n\n              case 5:\n                buffer = _context.sent;\n                setImageBuffer(decryptBuffer(buffer));\n\n              case 7:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n      return _fetchImage.apply(this, arguments);\n    }\n\n    if (inView && !onceRef.current) {\n      fetchImage();\n      onceRef.current = true;\n    }\n  }, [inView, publicURL]);\n  useEffect(function () {\n    if (inView) {\n      setBlobUrl(createBlobUrl(imageBuffer));\n    }\n\n    return function () {\n      if (blobUrl != null) {\n        URL.revokeObjectURL(blobUrl);\n      }\n    };\n  }, [imageBuffer, inView]);\n  var windowRatio = windowHeight / windowWidth;\n  var pageRatio = pageHeight / pageWidth;\n  var shouldSpanWidth = readingMode !== READING_MODE_HEIGHT;\n  var pageClassName = classnames(styles.page, (_classnames2 = {}, _classnames2[styles.pageSpanWidth] = shouldSpanWidth, _classnames2[styles.pageSpanHeight] = !shouldSpanWidth, _classnames2[styles.pageWebtoon] = readingMode === READING_MODE_WEBTOON, _classnames2));\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: pageClassName,\n    id: \"page-\" + index,\n    ref: ref,\n    onClick: function onClick(e) {\n      return onPageClick(e, index);\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.pageWrapper,\n    style: !shouldSpanWidth ? {\n      width: pageRatio < windowRatio ? \"100%\" : 100 / pageRatio + \"vh\"\n    } : undefined\n  }, shouldSpanWidth ? /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.pagePadding,\n    style: {\n      paddingTop: pageRatio * 100 + \"%\"\n    }\n  }) : null, inView && blobUrl != null ? /*#__PURE__*/React.createElement(Image, {\n    className: styles.pageImage,\n    src: blobUrl\n  }) : null));\n}","import React from \"react\";\nimport { graphql } from \"gatsby\";\n\nimport PageBook from \"miko/src/components/PageBook\";\n\nexport default function BookTemplate(props) {\n  return <PageBook {...props} />;\n}\n\nexport const pageQuery = graphql`\n  query BookByName($name: String!) {\n    bookMeta: json(name: { eq: $name }) {\n      dimensions\n      name\n    }\n    bookPages: allFile(\n      sort: { fields: relativePath }\n      filter: {\n        relativeDirectory: { eq: $name }\n        extension: { nin: [\"json\"] }\n        name: { regex: \"/^(?!thumbnail).*/\" }\n      }\n    ) {\n      edges {\n        node {\n          relativePath\n          publicURL\n          name\n        }\n      }\n    }\n  }\n`;\n"],"names":["IconLeft2Right","props","className","xmlns","fill","viewBox","fillOpacity","d","stroke","strokeLinecap","strokeLinejoin","strokeWidth","IconRight2Left","footerNavButton","headerButton","headerIcon","headerNavButton","DIRECTION_LEFT_TO_RIGHT","PageBook","_props$data","data","_props$data$bookMeta","bookMeta","dimensions","name","bookPages","_props$pageContext","pageContext","prevPath","nextPath","decryptedName","useMemo","_useLocalStorage","useLocalStorage","readingMode","setReadingMode","_useLocalStorage2","direction","setDirection","_useWindowSize","useWindowSize","windowWidth","width","windowHeight","height","_useState","useState","navHidden","setNavHidden","goBack","useCallback","pageIndex","currentPageEl","document","getElementById","getBoundingClientRect","top","scrollIntoView","goForward","edges","length","useEffect","click","x","y","ev","MouseEvent","view","window","bubbles","cancelable","clientX","clientY","elementFromPoint","dispatchEvent","downHandler","_ref","key","addEventListener","removeEventListener","onPageClick","e","innerWidth","clickX","flag","onReadingModeButtonClick","String","parseInt","onDirectionButtonClick","Layout","Header","title","hidden","map","_ref2","index","publicURL","node","_dimensions$index","pageWidth","pageHeight","Page","Link","to","_classnames","headerClassName","readingModeText","Logo","onClick","_classnames2","_useState2","imageBuffer","setImageBuffer","_useState3","blobUrl","setBlobUrl","onceRef","useRef","_useInView","rootMargin","ref","inView","_fetchImage","_callee","res","buffer","_context","prev","next","fetch","sent","arrayBuffer","stop","apply","this","arguments","current","fetchImage","URL","revokeObjectURL","windowRatio","pageRatio","shouldSpanWidth","pageClassName","id","style","undefined","paddingTop","Image","src","BookTemplate","React"],"sourceRoot":""}